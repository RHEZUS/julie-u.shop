import{B as z}from"./index-b9550106.js";import{B as N}from"./index-e5b31831.js";import{_ as R,u as Q,f as C,a as d,d as i,g as f,w as F,c as D,l as E,h as L,r as y,o as a,t as k,e as _,F as x,b as U,j as A,n as M}from"./index-583483ef.js";import{C as K}from"./index-5b63b34b.js";import{T as J}from"./index-97d86235.js";import{T as G}from"./index-7d062691.js";import{S as H}from"./index-d0b39234.js";import{F as W}from"./index-e765fc5d.js";import{S as X}from"./index-5ef74c9f.js";import{c as S,a as b,b as v,d as T,e as w}from"./array-32517c55.js";import"./index-8bd2886e.js";import"./utils-54aeb6c8.js";import"./vue-cleave.min-92d6160a.js";const Y={data(){return{toast:Q(),mediaUrl:C.defaults.baseURL+"/storage/",product:{title:"",description:"",brand_id:null,category_id:null,image:null,price:"",quantity:"",status:"draft",variants:[],options:[]},storing:!1,categories:[],brands:[],formErrors:{title:"",slug:"",description:"",brand_id:"",category_id:"",tags:"",image:"",price:"",status:"",variants:{title:"",price:"",sku:"",option1:"",option2:"",barcode:"",grams:"",weight:"",inventory_quantity:""},options:{name:"",position:"",values:""}}}},components:{Breadcrumb:z,Button:N,Card:K,Textinput:J,Textarea:G,Select:H,FileInput:W,Switch:X},methods:{handleFileUpload(o){this.product.image=o.target.files[0]},handleOptionFileSelected(o,s,t){this.product.options[s].values[t].images=Array.from(o.target.files)},createImageUrl(o){return URL.createObjectURL(o)},addOption(){this.product.options.push({name:"",values:[]})},removeOption(o){this.product.options.splice(o,1),this.generateVariants()},addValue(o){const s=Math.random().toString(36).substr(2,9),t={value:"",images_urls:null,uniqueCode:s};this.product.options[o].values.push(t);const r=[],e=this.product.options;if(e[o].values,e.length===1)r.push({title:"",sku:"",option1:"",option1_id:null,option2:null,option2_id:null,price:this.product.price.toString()|"0",inventory_quantity:this.product.quantity.toString()|"0",option1UniqueCode:s});else if(e.length===2){const c=e[o===0?1:0].values;if(e[o].values.length===1)this.product.variants.forEach(u=>{o===0?(u.option1=t.value,u.option1_id=t.id,u.option1UniqueCode=t.uniqueCode):(u.option2=t.value,u.option2_id=t.id,u.option2UniqueCode=t.uniqueCode)});else{const u=[];c.forEach(m=>{o===0?u.push({title:`${t.value} - ${m.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:t.value,option1_id:t.id,option2:m.value,option2_id:m.id,option1UniqueCode:t.uniqueCode,option2UniqueCode:m.uniqueCode}):u.push({title:`${m.value} - ${t.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:m.value,option1_id:m.id,option2:t.value,option2_id:t.id,option1UniqueCode:m.uniqueCode,option2UniqueCode:t.uniqueCode})}),this.product.variants=[...this.product.variants,...u]}}this.product.variants=[...this.product.variants,...r]},updateValue(o){console.log(o),this.product.variants.forEach(s=>{if(s.option1UniqueCode===o.uniqueCode){const t=s.title.split("-");s.option1=o.value,s.title=`${o.value.trim()} ${t[1]?"-"+t[1]:""}`}else if(s.option2UniqueCode&&s.option2UniqueCode===o.uniqueCode){const t=s.title.split("-");s.title=`${t[0].trim()} - ${o.value}`,s.option2=o.value}})},removeValue(o,s){const t=this.product.options[o].values[s];this.product.options[o].values=this.product.options[o].values.filter(r=>r!=t),this.generateVariants()},deleteOption(o){const s=this.product.options;if(s.splice(o,1)[0],s.length===0)this.product.variants=[];else if(s.length===1){const t=s[0].values.map(r=>r.value);this.product.variants=this.product.variants.filter(r=>t.includes(r.option1)||t.includes(r.option2)).map(r=>({...r,option1:r.option1||r.option2,option1_id:r.option1_id||r.option2_id,option2:null,option2_id:null,title:r.option1||r.option2,option1UniqueCode:r.option1UniqueCode||r.option2UniqueCode})).slice(0,t.length)}else if(s.length===2){const t=s,r=t[0].values,e=t[1].values,l=[];r.forEach(c=>{e.forEach(u=>{l.push({title:`${c.value} - ${u.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:c.value,option1_id:c.id,option2:u.value,option2_id:u.id,option1UniqueCode:c.uniqueCode})})}),this.product.variants=l}},deleteOptionValue(o,s){const t=this.product.options,r=t[o].values.splice(s,1)[0];if(t[o].values.length===0){if(t.splice(o,1),t.length===0)this.product.variants=[];else if(t.length===1){const e=t[0].values.map(l=>l.value);this.product.variants=this.product.variants.filter(l=>e.includes(l.option1)||e.includes(l.option2)).map(l=>({...l,option1:l.option1||l.option2,option1_id:l.option1_id||l.option2_id,option2:null,option2_id:null,title:l.option1||l.option2,option1UniqueCode:l.option1UniqueCode||l.option2UniqueCode}))}}else if(t.length===1)this.product.variants=this.product.variants.filter(e=>e.option1!==r.value);else if(t.length===2){this.product.variants=this.product.variants.filter(u=>o===0?u.option1!==r.value:u.option2!==r.value);const e=t[0].values,l=t[1].values,c=[];e.forEach(u=>{l.forEach(m=>{c.push({title:`${u.value} - ${m.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:u.value,option1_id:u.id,option2:m.value,option2_id:m.id,option1UniqueCode:u.uniqueCode})})}),this.product.variants=c}},showVariants(){return this.product.options.some(o=>o.values.length>0)},async validateForm(){this.formErrors={},this.storing=!0;const o=t=>{const r=t.map(e=>e.value);return new Set(r).size===r.length};S({title:b().required("Title field is required"),description:b().required("Description field is required"),brand_id:v().nullable(),category_id:v().required("Category field is required"),image:T().nullable(),price:v().required("Price field is required").min(1,"Price must be greater than 0"),quantity:v().required("Quantity field is required").min(1,"Quantity must be greater than 0"),status:b().required("Status field is required"),variants:w().of(S().shape({title:b().required("Title field is required"),price:v().required("Price field is required"),inventory_quantity:v().required("Inventory Quantity field is required")})),options:w().of(S().shape({name:b().required("Option name field is required"),values:w().of(S().shape({value:b().required("Option value field is required"),images:w().of(T()).nullable()})).test("unique","Option values must be unique",o)}))}).validate(this.product,{abortEarly:!1}).then(()=>{console.log("Form is valid, Creating products"),this.updateProduct().then(()=>{this.storing=!1})}).catch(t=>{console.log("Form is invalid"),t.inner.forEach(r=>{this.formErrors[r.path]=r.message}),console.log("Form errors",this.formErrors),console.log("Error",t),this.storing=!1})},async updateProduct(){this.errors=[],console.log(this.product),await C.post(`/api/admin/product/update/${this.product.id}`,this.product,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{this.toast.success("Product created successfully",{timeout:2e3}),console.log(o),this.$router.push({name:"products"})}).catch(o=>{this.toast.error("Failed to create product",{timeout:2e3}),console.log(o)})}},async mounted(){try{const o=await C.get("/api/admin/categories/id-name"),s=await C.get("/api/admin/brands/id-name"),t=await C.get(`/api/admin/product/${this.$route.params.id}`);this.categories=o.data.categories,this.brands=s.data.brands,this.product=t.data.product,this.product.price=this.product.variants[0].price.toString(),this.product.quantity=this.product.variants[0].inventory_quantity.toString();let r={};for(let e=0;e<this.product.options.length;e++)for(let l=0;l<this.product.options[e].values.length;l++){let c=this.product.options[e].values[l].id,u=this.product.options[e].values[l].value,m=Math.random().toString(36).substr(2,9);this.product.options[e].values[l].uniqueCode=m,r[c]=m,r[u]=m}this.product.variants.forEach(e=>{e.inventory_quantity=e.inventory_quantity.toString(),(r[e.option1_id]||r[e.option1])&&(e.option1UniqueCode=r[e.option1_id]||r[e.option1]),(r[e.option2_id]||r[e.option1])&&(e.option2UniqueCode=r[e.option2_id]||r[e.option1])}),console.log(this.product)}catch{this.toast.error("Failed to load categories and brands")}}},Z={class:""},I=i("div",{class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},[i("h5",{class:"h5"},"Update Product")],-1),$={class:"text-base text-slate-600 dark:text-slate-300 grid grid-cols-12 items-center gap-4"},ee={class:"col-span-12 md:col-span-6"},te={class:"col-span-12 md:col-span-6"},oe={class:"col-span-12 md:col-span-6"},se={class:"col-span-12 sm:col-span-6"},ie={key:0,class:"col-span-full text-danger-500 mt-2 text-sm block"},re={class:"col-span-12"},le={class:"col-span-12 md:col-span-6"},ne={class:"col-span-12 md:col-span-6"},ue={class:"col-span-12 sm:col-span-6"},ae=i("div",{class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},[i("h5",{class:"h5"},"Product Variants")],-1),de={key:0,class:"text-base text-slate-600 dark:text-slate-300 items-center gap-4 rounded-lg"},pe={class:""},ce={class:"flex justify-between py-2"},me=i("label",{for:""}," Option Name ",-1),he=["onClick"],fe=i("span",{class:"text-base"}," Delete option ",-1),_e=[fe],ge={class:""},ye={class:"flex justify-between py-2"},be=i("label",{for:""}," Option Values ",-1),ve=["onClick"],qe=i("i",{class:"bx bx-plus"},null,-1),Ve={class:"text-base"},Ce={key:0,class:"mt-2 text-danger-500 text-sm"},xe={key:0,class:"col-span-6"},Ue=["onChange"],ke={key:0,class:"text-danger-600 text-sm"},Se={key:1,class:"flex gap-3 py-2"},we=["onClick"],Ee=i("i",{class:"bx bx-trash"},null,-1),Oe=[Ee],Fe=["src"],Te={key:2,class:"flex gap-3 py-2"},Pe=["onClick"],Be=i("i",{class:"bx bx-trash"},null,-1),je=[Be],ze=["src"],Ne=["onClick"],Re=i("i",{class:"bx bx-trash"},null,-1),Qe=[Re],De={key:1,class:"text-blue-600 pointer-events-auto"},Le=i("i",{class:"bx bx-plus"},null,-1),Ae={key:2,class:"mt-8"},Me={class:"table-auto w-full"},Ke=i("tr",null,[i("th",{class:"text-left h6 text-sm"},"Title"),i("th",{class:"text-left h6 text-sm"},"Price"),i("th",{class:"text-left h6 text-sm"},"Inventory Quantity")],-1),Je={class:"col-span-12 py-3 flex justify-end space-x-3 border-t border-slate-100 dark:border-slate-700"},Ge={key:1,type:"button",class:"px-3 py-2 bg-blue-600 flex items-center gap-2 rounded"},He=i("div",{class:"flex flex-row space-x-4"},[i("div",{class:"w-4 h-4 rounded-full animate-spin border-2 border-dashed border-white border-t-transparent"})],-1);function We(o,s,t,r,e,l){const c=y("Textinput"),u=y("Select"),m=y("Textarea"),P=y("Switch"),O=y("Card"),B=y("Button");return a(),d("div",Z,[i("form",{onSubmit:s[9]||(s[9]=L(n=>l.validateForm(),["prevent"])),class:"flex flex-col gap-4 relative z-[100]"},[f(O,{noborder:""},{default:F(()=>[I,i("div",$,[i("div",ee,[f(c,{type:"text",placeholder:"Name of the product",name:"name",modelValue:e.product.title,"onUpdate:modelValue":s[0]||(s[0]=n=>e.product.title=n),error:e.formErrors.title,classInput:"h-[48px]"},null,8,["modelValue","error"])]),i("div",te,[f(u,{modelValue:e.product.category_id,"onUpdate:modelValue":s[1]||(s[1]=n=>e.product.category_id=n),error:e.formErrors.category_id,options:e.categories,placeholder:"Select category",classInput:"h-[48px]"},null,8,["modelValue","error","options"])]),i("div",oe,[f(u,{modelValue:e.product.brand_id,"onUpdate:modelValue":s[2]||(s[2]=n=>e.product.brand_id=n),error:e.formErrors.brand_id,options:e.brands,placeholder:"Select Brand",classInput:"h-[48px]"},null,8,["modelValue","error","options"])]),i("div",se,[i("input",{type:"file",name:"file-input-medium",id:"file-input-medium",onChange:s[3]||(s[3]=(...n)=>l.handleFileUpload&&l.handleFileUpload(...n)),class:"block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4"},null,32),e.formErrors.image?(a(),d("div",ie,k(e.formErrors.image),1)):_("",!0)]),i("div",re,[f(m,{placeholder:"Description of the product",modelValue:e.product.description,"onUpdate:modelValue":s[4]||(s[4]=n=>e.product.description=n),error:e.formErrors.description,hasicon:"",classInput:"min-h-[48px]"},null,8,["modelValue","error"])]),i("div",le,[f(c,{type:"text",placeholder:"Price",modelValue:e.product.price,"onUpdate:modelValue":s[5]||(s[5]=n=>e.product.price=n),error:e.formErrors.price,classInput:"h-[48px]"},null,8,["modelValue","error"])]),i("div",ne,[f(c,{type:"number",placeholder:"Quantity",modelValue:e.product.quantity,"onUpdate:modelValue":s[6]||(s[6]=n=>e.product.quantity=n),error:e.formErrors.quantity,classInput:"h-[48px]"},null,8,["modelValue","error"])]),i("div",ue,[f(P,{label:"Is published",class:"",modelValue:e.product.status,"onUpdate:modelValue":s[7]||(s[7]=n=>e.product.status=n),activeClass:"bg-primary-500",active:!!e.product.status},null,8,["modelValue","active"])])])]),_:1}),f(O,{noborder:""},{default:F(()=>[ae,e.product.options.length>0?(a(),d("div",de,[(a(!0),d(x,null,U(e.product.options,(n,h)=>(a(),d("div",{class:"p-2 flex flex-col gap-2 relative border mb-2",key:h},[i("div",pe,[i("div",ce,[me,i("button",{onClick:p=>l.deleteOption(h),type:"button",class:"float-end text-xl text-danger-600 flex items-center"},_e,8,he)]),f(u,{modelValue:n.name,"onUpdate:modelValue":p=>n.name=p,error:e.formErrors[`options[${h}].name`],options:[{label:"Color",value:"color"},{label:"Size",value:"size"}],placeholder:"Select option",classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])]),i("div",ge,[i("div",ye,[be,i("button",{onClick:p=>l.addValue(h),type:"button",class:"float-end text-xl text-blue-600 flex items-center"},[qe,E(),i("span",Ve," Add another "+k(n.name?n.name:"Value"),1)],8,ve)]),e.formErrors[`options[${h}].values`]?(a(),d("div",Ce,k(e.formErrors[`options[${h}].values`]),1)):_("",!0),(a(!0),d(x,null,U(n.values,(p,q)=>(a(),d("div",{class:"grid grid-cols-12 relative gap-2 pr-10 items-center justify-between mt-3",key:p.code},[i("div",{class:A(["relative h-fit",{"col-span-6":n.name=="color","col-span-12":n.name!="color"}])},[f(c,{type:"text",placeholder:"Value",modelValue:p.value,"onUpdate:modelValue":g=>p.value=g,onKeyup:g=>l.updateValue(p),error:e.formErrors[`options[${h}].values[${q}].value`],classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","onKeyup","error"]),n.name=="color"?(a(),d("div",{key:0,class:"w-4 h-4 rounded-full absolute top-3 right-3",style:M({backgroundColor:p.value})},null,4)):_("",!0)],2),n.name=="color"?(a(),d("div",xe,[i("input",{type:"file",multiple:"",name:"file-input-medium",id:"file-input-medium",onChange:g=>l.handleOptionFileSelected(g,h,q),class:"block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4"},null,40,Ue),e.formErrors[`options[${h}].values[${q}].images_urls`]?(a(),d("p",ke,k(e.formErrors[`options[${h}].values[${q}].images_urls`]),1)):_("",!0),p.images_urls&&!p.images?(a(),d("div",Se,[(a(!0),d(x,null,U(JSON.parse(p.images_urls),(g,V)=>(a(),d("div",{class:"relative",key:V},[i("label",{for:"file-input-medium hidden",onClick:j=>o.deleOptionImage(o.optionValueId,V),class:"cursor-pointer text-danger-600 absolute right-0"},Oe,8,we),i("img",{class:"h-20 w-16",src:e.mediaUrl+g,alt:""},null,8,Fe)]))),128))])):_("",!0),p.images?(a(),d("div",Te,[(a(!0),d(x,null,U(p.images,(g,V)=>(a(),d("div",{class:"relative",key:V},[i("label",{for:"file-input-medium hidden",onClick:j=>o.deleOptionImage(o.optionValueId,V),class:"cursor-pointer text-danger-600 absolute right-0 hidden"},je,8,Pe),i("img",{class:"h-20 w-16",src:l.createImageUrl(g),alt:""},null,8,ze)]))),128))])):_("",!0)])):_("",!0),i("button",{onClick:g=>l.deleteOptionValue(h,q),type:"button",class:"float-end text-xl absolute top-0 bottom-0 right-0"},Qe,8,Ne)]))),128))])]))),128))])):_("",!0),e.product.options.length<2?(a(),d("div",De,[i("button",{onClick:s[8]||(s[8]=n=>l.addOption()),type:"button",class:""},[Le,E(" Add options like color or size")])])):_("",!0),l.showVariants()?(a(),d("div",Ae,[i("table",Me,[Ke,(a(!0),d(x,null,U(e.product.variants,(n,h)=>(a(),d("tr",{key:h},[i("td",null,[f(c,{type:"text","aria-readonly":"true",placeholder:"Title",name:"title",modelValue:n.title,"onUpdate:modelValue":p=>n.title=p,error:e.formErrors[`variants[${h}].title`],classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])]),i("td",null,[f(c,{type:"text",placeholder:"Price",name:"price",modelValue:n.price,"onUpdate:modelValue":p=>n.price=p,error:e.formErrors[`variants[${h}].price`],classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])]),i("td",null,[f(c,{type:"number",placeholder:"Inventory Quantity",name:"inventory_quantity",modelValue:n.inventory_quantity,"onUpdate:modelValue":p=>n.inventory_quantity=p,error:e.formErrors[`variants[${h}].inventory_quantity`],classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])])]))),128))])])):_("",!0)]),_:1}),i("div",Je,[e.storing?(a(),d("button",Ge,[He,E(" Saving ")])):(a(),D(B,{key:0,type:"submit",text:"Save",btnClass:"btn-primary h-10 flex items-center"}))])],32)])}const ut=R(Y,[["render",We]]);export{ut as default};
