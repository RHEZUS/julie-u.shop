import{B as j}from"./index-327ed9fa.js";import{B as z}from"./index-ec894d07.js";import{_ as N,u as Q,x as R,f as w,a as d,d as s,g as f,w as F,c as A,l as S,h as D,r as b,o as u,j as T,t as x,e as _,F as C,b as U}from"./index-88b678ca.js";import{C as L}from"./index-6254fa1c.js";import{T as M}from"./index-26f9d83b.js";import{T as K}from"./index-12a3c277.js";import{S as G}from"./index-8d69cdf0.js";import{F as H}from"./index-22ef99ce.js";import{S as J}from"./index-758e7c19.js";import{c as V,a as y,b as v,d as W,e as k}from"./array-b8016554.js";import"./index-cb27a196.js";import"./utils-54aeb6c8.js";import"./vue-cleave.min-5b332cbf.js";const X={data(){return{toast:Q(),mediaUrl:R.defaults.baseURL+"/storage/",product:{title:"",description:"",brand_id:null,category_id:void 0,image:null,price:"0",quantity:"0",status:"draft",variants:[],options:[]},storing:!1,categories:[],brands:[],formErrors:{title:"",slug:"",description:"",brand_id:"",category_id:"",tags:"",image:"",price:"",status:"",variants:{title:"",price:"",sku:"",option1:"",option2:"",barcode:"",grams:"",weight:"",inventory_quantity:""},options:{name:"",position:"",values:""}}}},components:{Breadcrumb:j,Button:z,Card:L,Textinput:M,Textarea:K,Select:G,FileInput:H,Switch:J},methods:{async validateForm(){console.log("Validating form"),this.formErrors={},this.storing=!0;const i=o=>{const l=o.map(e=>e.value);return new Set(l).size===l.length};V({title:y().required("Title field is required"),description:y().required("Description field is required"),brand_id:v().nullable("Brand field is required"),category_id:v().required("Category field is required"),image:W().required("Image field is required"),price:v().required("Price field is required").min(1,"Price must be greater than 0"),quantity:v().required("Quantity field is required").min(1,"Quantity must be greater than 0"),status:y().required("Status field is required"),variants:k().of(V().shape({title:y().required("Title field is required"),price:v().required("Price field is required"),inventory_quantity:v().required("Inventory Quantity field is required")})),options:k().of(V().shape({name:y().required("Option name field is required"),values:k().of(V().shape({value:y().required("Option value field is required"),images_urls:k().of(V().shape({url:y().required("Image field is required")}))})).test("unique","Option values must be unique",i)}))}).validate(this.product,{abortEarly:!1}).then(()=>{console.log("Form is valid, Creating products"),this.createProduct().then(()=>{this.storing=!1})}).catch(o=>{console.log("Form is invalid"),o.inner.forEach(l=>{this.formErrors[l.path]=l.message}),console.log("Form errors",this.formErrors),console.log("Error",o),this.storing=!1})},async createProduct(){this.storing=!0,this.errors=[],this.product.variants.length===0&&this.createVariant(),console.log(this.product),await w.post("/api/admin/product/create",this.product,{headers:{"Content-Type":"multipart/form-data"}}).then(i=>{this.toast.success("Product created successfully",{timeout:2e3}),console.log(i),this.storing=!1}).catch(i=>{this.toast.error("Failed to create product",{timeout:2e3}),console.log(i),this.storing=!1})},handleFileUpload(i){this.product.image=i.target.files[0]},handleOptionFileSelected(i,t,o){this.product.options[t].values[o].images=Array.from(i.target.files),this.product.options[t].values[o].images_urls=Array.from(i.target.files).map(l=>URL.createObjectURL(l))},addOption(){this.product.options.push({name:"",values:[]})},addValue(i){const t=Math.random().toString(36).substr(2,9),o={value:"",images_urls:null,uniqueCode:t};this.product.options[i].values.push(o);const l=[],e=this.product.options;if(e[i].values,e.length===1)l.push({title:"",sku:"",option1:o.value,option1_id:null,option2:null,option2_id:null,price:this.product.price.toString()|"0",inventory_quantity:this.product.quantity.toString()|"0",option1UniqueCode:t});else if(e.length===2){const p=e[i===0?1:0].values;if(e[i].values.length===1)this.product.variants.forEach(a=>{i===0?(a.option1=o.value,a.option1_id=o.id,a.option1UniqueCode=o.uniqueCode):(a.option2=o.value,a.option2_id=o.id,a.option2UniqueCode=o.uniqueCode)});else{const a=[];p.forEach(h=>{i===0?a.push({title:`${o.value} - ${h.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:o.value,option1_id:o.id,option2:h.value,option2_id:h.id,option1UniqueCode:o.uniqueCode,option2UniqueCode:h.uniqueCode}):a.push({title:`${h.value} - ${o.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:h.value,option1_id:h.id,option2:o.value,option2_id:o.id,option1UniqueCode:h.uniqueCode,option2UniqueCode:o.uniqueCode})}),this.product.variants=[...this.product.variants,...a]}}this.product.variants=[...this.product.variants,...l]},updateValue(i){console.log(i),this.product.variants.forEach(t=>{if(t.option1UniqueCode===i.uniqueCode){const o=t.title.split("-");t.option1=i.value,t.title=`${i.value.trim()} ${o[1]?"-"+o[1]:""}`}else if(t.option2UniqueCode&&t.option2UniqueCode===i.uniqueCode){const o=t.title.split("-");t.title=`${o[0].trim()} - ${i.value}`,t.option2=i.value}})},deleteOption(i){const t=this.product.options;if(t.splice(i,1)[0],t.length===0)this.product.variants=[];else if(t.length===1){const o=t[0].values.map(l=>l.value);this.product.variants=this.product.variants.filter(l=>o.includes(l.option1)||o.includes(l.option2)).map(l=>({...l,option1:l.option1||l.option2,option1_id:l.option1_id||l.option2_id,option2:null,option2_id:null,title:l.option1||l.option2,option1UniqueCode:l.option1UniqueCode||l.option2UniqueCode})).slice(0,o.length)}else if(t.length===2){const o=t,l=o[0].values,e=o[1].values,n=[];l.forEach(p=>{e.forEach(a=>{n.push({title:`${p.value} - ${a.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:p.value,option1_id:p.id,option2:a.value,option2_id:a.id,option1UniqueCode:p.uniqueCode})})}),this.product.variants=n}},deleteOptionValue(i,t){const o=this.product.options,l=o[i].values.splice(t,1)[0];if(o[i].values.length===0){if(o.splice(i,1),o.length===0)this.product.variants=[];else if(o.length===1){const e=o[0].values.map(n=>n.value);this.product.variants=this.product.variants.filter(n=>e.includes(n.option1)||e.includes(n.option2)).map(n=>({...n,option1:n.option1||n.option2,option1_id:n.option1_id||n.option2_id,option2:null,option2_id:null,title:n.option1||n.option2,option1UniqueCode:n.option1UniqueCode||n.option2UniqueCode}))}}else if(o.length===1)this.product.variants=this.product.variants.filter(e=>e.option1!==l.value);else if(o.length===2){this.product.variants=this.product.variants.filter(a=>i===0?a.option1!==l.value:a.option2!==l.value);const e=o[0].values,n=o[1].values,p=[];e.forEach(a=>{n.forEach(h=>{p.push({title:`${a.value} - ${h.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:a.value,option1_id:a.id,option2:h.value,option2_id:h.id,option1UniqueCode:a.uniqueCode})})}),this.product.variants=p}},createVariant(){let i={title:"",price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:Math.random().toString(36).substr(2,9),option1:"",option1_id:null,option2:"",option2_id:null,option1UniqueCode:"",option2UniqueCode:""};this.product.variants=[i]},clearForm(){this.product={title:"",description:"",brand_id:null,category_id:null,image:null,price:"",quantity:"",status:"draft",variants:[],options:[]}},showVariants(){return this.product.options.some(i=>i.values.length>0)}},async mounted(){try{const i=await w.get("/api/admin/categories/id-name"),t=await w.get("/api/admin/brands/id-name");this.categories=i.data.categories,this.brands=t.data.brands}catch{this.toast.error("Failed to load categories and brands")}}},Y={class:""},Z=s("div",{class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},[s("h5",{class:"h5"},"Create new product")],-1),I={class:"text-base text-slate-600 dark:text-slate-300 grid grid-cols-12 items-center gap-4"},$={class:"col-span-12 md:col-span-6"},ee={class:"col-span-12 md:col-span-6"},te={class:"col-span-12 md:col-span-6"},oe={class:"col-span-12 sm:col-span-6"},se={key:0,class:"col-span-full text-danger-500 mt-2 text-sm block"},ie={class:"col-span-12"},re={class:"col-span-12 md:col-span-6"},le={class:"col-span-12 md:col-span-6"},ne={class:"col-span-12 sm:col-span-6"},ae=s("div",{class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},[s("h5",{class:"h5"},"Product Variants")],-1),ue={key:0,class:"text-base text-slate-600 dark:text-slate-300 items-center gap-4 rounded-lg"},de={class:""},pe={class:"flex justify-between py-2"},ce=s("label",{for:""}," Option Name ",-1),me=["onClick"],he=s("span",{class:"text-base"}," Delete option ",-1),fe=[he],_e={class:""},ge={class:"flex justify-between py-2"},ye=s("label",{for:""}," Option Values ",-1),be=["onClick"],ve=s("i",{class:"bx bx-plus"},null,-1),qe={class:"text-base"},Ve={key:0,class:"mt-2 text-danger-500 text-sm"},xe={key:0,class:"col-span-6"},Ce=["onChange"],Ue={key:0,class:"text-danger-600 text-sm"},ke={key:1,class:"flex gap-3 py-2"},we=["onClick"],Se=s("i",{class:"bx bx-trash"},null,-1),Ee=[Se],Oe=["src"],Fe=["onClick"],Te=s("i",{class:"bx bx-trash"},null,-1),Be=[Te],Pe={key:1,class:"text-blue-600 pointer-events-auto"},je=s("i",{class:"bx bx-plus"},null,-1),ze={key:2,class:"mt-8"},Ne={class:"table-auto w-full"},Qe=s("tr",null,[s("th",{class:"text-left h6 text-sm"},"Title"),s("th",{class:"text-left h6 text-sm"},"Price"),s("th",{class:"text-left h6 text-sm"},"Inventory Quantity")],-1),Re={class:"col-span-12 py-3 flex justify-end space-x-3 border-t border-slate-100 dark:border-slate-700"},Ae={key:1,type:"button",class:"text-white px-3 py-2 bg-blue-600 flex items-center gap-2 rounded"},De=s("div",{class:"flex flex-row space-x-4"},[s("div",{class:"w-4 h-4 rounded-full animate-spin border-2 border-dashed border-white border-t-transparent"})],-1);function Le(i,t,o,l,e,n){const p=b("Textinput"),a=b("Select"),h=b("Textarea"),B=b("Switch"),E=b("Card"),P=b("Button");return u(),d("div",Y,[s("form",{onSubmit:t[9]||(t[9]=D(r=>n.validateForm(),["prevent"])),class:"flex flex-col gap-4 relative z-[100]"},[f(E,{noborder:""},{default:F(()=>[Z,s("div",I,[s("div",$,[f(p,{type:"text",placeholder:"Name of the product",name:"name",modelValue:e.product.title,"onUpdate:modelValue":t[0]||(t[0]=r=>e.product.title=r),error:e.formErrors.title,classInput:"h-[48px]"},null,8,["modelValue","error"])]),s("div",ee,[f(a,{modelValue:e.product.category_id,"onUpdate:modelValue":t[1]||(t[1]=r=>e.product.category_id=r),error:e.formErrors.category_id,options:e.categories,placeholder:"Select category",classInput:"h-[48px]"},null,8,["modelValue","error","options"])]),s("div",te,[f(a,{modelValue:e.product.brand_id,"onUpdate:modelValue":t[2]||(t[2]=r=>e.product.brand_id=r),error:e.formErrors.brand_id,options:e.brands,placeholder:"Select Brand",classInput:"h-[48px]"},null,8,["modelValue","error","options"])]),s("div",oe,[s("input",{type:"file",name:"file-input-medium",class:T([e.formErrors.image?"border-danger-500":"border-gray-200","block w-full border shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4"]),id:"file-input-medium",onChange:t[3]||(t[3]=(...r)=>n.handleFileUpload&&n.handleFileUpload(...r))},null,34),e.formErrors.image?(u(),d("div",se,x(e.formErrors.image),1)):_("",!0)]),s("div",ie,[f(h,{placeholder:"Description of the product",modelValue:e.product.description,"onUpdate:modelValue":t[4]||(t[4]=r=>e.product.description=r),error:e.formErrors.description,hasicon:"",classInput:"min-h-[48px]"},null,8,["modelValue","error"])]),s("div",re,[f(p,{type:"text",placeholder:"Price",modelValue:e.product.price,"onUpdate:modelValue":t[5]||(t[5]=r=>e.product.price=r),error:e.formErrors.price,classInput:"h-[48px]"},null,8,["modelValue","error"])]),s("div",le,[f(p,{type:"number",placeholder:"Quantity",modelValue:e.product.quantity,"onUpdate:modelValue":t[6]||(t[6]=r=>e.product.quantity=r),error:e.formErrors.quantity,classInput:"h-[48px]"},null,8,["modelValue","error"])]),s("div",ne,[f(B,{label:"Is published",class:"",modelValue:e.product.status,"onUpdate:modelValue":t[7]||(t[7]=r=>e.product.status=r),activeClass:"bg-primary-500",active:!!e.product.status},null,8,["modelValue","active"])])])]),_:1}),f(E,{noborder:""},{default:F(()=>[ae,e.product.options.length>0?(u(),d("div",ue,[(u(!0),d(C,null,U(e.product.options,(r,c)=>(u(),d("div",{class:"p-2 flex flex-col gap-2 relative border mb-2",key:c},[s("div",de,[s("div",pe,[ce,s("button",{onClick:m=>n.deleteOption(c),type:"button",class:"float-end text-xl text-danger-600 flex items-center"},fe,8,me)]),f(a,{modelValue:r.name,"onUpdate:modelValue":m=>r.name=m,error:e.formErrors[`options[${c}].name`],options:[{label:"Color",value:"color"},{label:"Size",value:"size"}],placeholder:"Select option",classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])]),s("div",_e,[s("div",ge,[ye,s("button",{onClick:m=>n.addValue(c),type:"button",class:"float-end text-xl text-blue-600 flex items-center"},[ve,S(),s("span",qe," Add another "+x(r.name?r.name:"Value"),1)],8,be)]),e.formErrors[`options[${c}].values`]?(u(),d("div",Ve,x(e.formErrors[`options[${c}].values`]),1)):_("",!0),(u(!0),d(C,null,U(r.values,(m,q)=>(u(),d("div",{class:"grid grid-cols-12 relative gap-2 pr-10 items-center justify-between mt-3",key:m.code},[s("div",{class:T(["",{"col-span-6":r.name=="color","col-span-12":r.name!="color"}])},[f(p,{type:"text",placeholder:"Value",error:e.formErrors[`options[${c}].values[${q}].value`],modelValue:m.value,"onUpdate:modelValue":g=>m.value=g,onKeyup:g=>n.updateValue(m),classInput:"h-[35px]"},null,8,["type","error","modelValue","onUpdate:modelValue","onKeyup"])],2),r.name=="color"?(u(),d("div",xe,[s("input",{type:"file",multiple:"",name:"file-input-medium",id:"file-input-medium",onChange:g=>n.handleOptionFileSelected(g,c,q),class:"block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4"},null,40,Ce),e.formErrors[`options[${c}].values[${q}].images_urls`]?(u(),d("p",Ue,x(e.formErrors[`options[${c}].values[${q}].images_urls`]),1)):_("",!0),m.images_urls?(u(),d("div",ke,[(u(!0),d(C,null,U(m.images_urls,(g,O)=>(u(),d("div",{class:"relative",key:O},[s("label",{for:"file-input-medium hidden",onClick:Me=>i.deleOptionImage(i.optionValueId,O),class:"cursor-pointer text-danger-600 absolute right-0"},Ee,8,we),s("img",{class:"h-20 w-16",src:g,alt:""},null,8,Oe)]))),128))])):_("",!0)])):_("",!0),s("button",{onClick:g=>n.deleteOptionValue(c,q),type:"button",class:"float-end text-xl absolute top-0 bottom-0 right-0"},Be,8,Fe)]))),128))])]))),128))])):_("",!0),e.product.options.length<2?(u(),d("div",Pe,[s("button",{onClick:t[8]||(t[8]=r=>n.addOption()),type:"button",class:""},[je,S(" Add options like color or size")])])):_("",!0),n.showVariants()?(u(),d("div",ze,[s("table",Ne,[Qe,(u(!0),d(C,null,U(e.product.variants,(r,c)=>(u(),d("tr",{key:c},[s("td",null,[f(p,{type:"text",placeholder:"Title",name:"title",error:e.formErrors[`variants[${c}].title`],modelValue:r.title,"onUpdate:modelValue":m=>r.title=m,classInput:"h-[35px]"},null,8,["error","modelValue","onUpdate:modelValue"])]),s("td",null,[f(p,{type:"text",placeholder:"Price",name:"price",error:e.formErrors[`variants[${c}].price`],modelValue:r.price,"onUpdate:modelValue":m=>r.price=m,classInput:"h-[35px]"},null,8,["error","modelValue","onUpdate:modelValue"])]),s("td",null,[f(p,{type:"number",placeholder:"Inventory Quantity",error:e.formErrors[`variants[${c}].inventory_quantity`],name:"inventory_quantity",modelValue:r.inventory_quantity,"onUpdate:modelValue":m=>r.inventory_quantity=m,classInput:"h-[35px]"},null,8,["error","modelValue","onUpdate:modelValue"])])]))),128))])])):_("",!0)]),_:1}),s("div",Re,[e.storing?(u(),d("button",Ae,[De,S(" Saving ")])):(u(),A(P,{key:0,type:"submit",text:"Save",btnClass:"btn-primary h-10 flex items-center"}))])],32)])}const st=N(X,[["render",Le]]);export{st as default};
