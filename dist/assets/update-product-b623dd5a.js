import{B as E}from"./index-ccda43c4.js";import{B as O}from"./index-338dc922.js";import{_ as F,u as T,f as b,a as p,d as o,g as m,w as k,c as B,l as V,i as P,r as g,o as a,F as v,b as x,t as j,j as z,n as I,e as y}from"./index-95066904.js";import{C as N}from"./index-0f0aeca9.js";import{T as R}from"./index-16cf0800.js";import{T as A}from"./index-8134bbe5.js";import{S as D}from"./index-41f36d12.js";import{F as M}from"./index-4046c02c.js";import{S as Q}from"./index-bc13edaf.js";import"./index-ead31d90.js";import"./utils-54aeb6c8.js";import"./vue-cleave.min-45643fef.js";const K={data(){return{toast:T(),mediaUrl:b.defaults.baseURL+"/storage/",product:{title:"",description:"",brand_id:null,category_id:null,image:null,price:"",quantity:"",status:"draft",variants:[],options:[]},storing:!1,categories:[],brands:[],formErrors:{title:"",slug:"",description:"",brand_id:"",category_id:"",tags:[],image:"",price:"",status:"",variants:{title:"",price:"",sku:"",option1:"",option2:"",barcode:"",grams:"",weight:"",inventory_quantity:""},options:{name:"",position:"",values:""}}}},components:{Breadcrumb:E,Button:O,Card:N,Textinput:R,Textarea:A,Select:D,FileInput:M,Switch:Q},methods:{handleFileUpload(i){this.product.image=i.target.files[0]},handleOptionFileSelected(i,e,s){this.product.options[e].values[s].images=Array.from(i.target.files)},addOption(){this.product.options.push({name:"",values:[]})},removeOption(i){this.product.options.splice(i,1),this.generateVariants()},addValue(i){const e=Math.random().toString(36).substr(2,9),s={value:"",images_urls:null,uniqueCode:e};this.product.options[i].values.push(s);const r=[],t=this.product.options;if(t[i].values,t.length===1)r.push({title:"",sku:"",option1:"",option1_id:null,option2:null,option2_id:null,price:this.product.price.toString()|"0",inventory_quantity:this.product.quantity.toString()|"0",option1UniqueCode:e});else if(t.length===2){const d=t[i===0?1:0].values;if(t[i].values.length===1)this.product.variants.forEach(u=>{i===0?(u.option1=s.value,u.option1_id=s.id,u.option1UniqueCode=s.uniqueCode):(u.option2=s.value,u.option2_id=s.id,u.option2UniqueCode=s.uniqueCode)});else{const u=[];d.forEach(c=>{i===0?u.push({title:`${s.value} - ${c.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:s.value,option1_id:s.id,option2:c.value,option2_id:c.id,option1UniqueCode:s.uniqueCode,option2UniqueCode:c.uniqueCode}):u.push({title:`${c.value} - ${s.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:c.value,option1_id:c.id,option2:s.value,option2_id:s.id,option1UniqueCode:c.uniqueCode,option2UniqueCode:s.uniqueCode})}),this.product.variants=[...this.product.variants,...u]}}this.product.variants=[...this.product.variants,...r]},updateValue(i){console.log(i),this.product.variants.forEach(e=>{if(e.option1UniqueCode===i.uniqueCode){const s=e.title.split("-");e.title=`${i.value.trim()} ${s[1]?"-"+s[1]:""}`}else if(e.option2UniqueCode&&e.option2UniqueCode===i.uniqueCode){const s=e.title.split("-");e.title=`${s[0].trim()} - ${i.value}`}})},removeValue(i,e){this.product.options[i].values.splice(e,1),this.generateVariants()},deleteOption(i){const e=this.product.options;if(e.splice(i,1)[0],e.length===0)this.product.variants=[];else if(e.length===1){const s=e[0].values.map(r=>r.value);this.product.variants=this.product.variants.filter(r=>s.includes(r.option1)||s.includes(r.option2)).map(r=>({...r,option1:r.option1||r.option2,option1_id:r.option1_id||r.option2_id,option2:null,option2_id:null,title:r.option1||r.option2,option1UniqueCode:r.option1UniqueCode||r.option2UniqueCode})).slice(0,s.length)}else if(e.length===2){const s=e,r=s[0].values,t=s[1].values,n=[];r.forEach(d=>{t.forEach(u=>{n.push({title:`${d.value} - ${u.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:d.value,option1_id:d.id,option2:u.value,option2_id:u.id,option1UniqueCode:d.uniqueCode})})}),this.product.variants=n}},deleteOptionValue(i,e){const s=this.product.options,r=s[i].values.splice(e,1)[0];if(s[i].values.length===0){if(s.splice(i,1),s.length===0)this.product.variants=[];else if(s.length===1){const t=s[0].values.map(n=>n.value);this.product.variants=this.product.variants.filter(n=>t.includes(n.option1)||t.includes(n.option2)).map(n=>({...n,option1:n.option1||n.option2,option1_id:n.option1_id||n.option2_id,option2:null,option2_id:null,title:n.option1||n.option2,option1UniqueCode:n.option1UniqueCode||n.option2UniqueCode}))}}else if(s.length===1)this.product.variants=this.product.variants.filter(t=>t.option1!==r.value);else if(s.length===2){this.product.variants=this.product.variants.filter(u=>i===0?u.option1!==r.value:u.option2!==r.value);const t=s[0].values,n=s[1].values,d=[];t.forEach(u=>{n.forEach(c=>{d.push({title:`${u.value} - ${c.value}`,price:this.product.price.toString()||"0",inventory_quantity:this.product.quantity.toString()||"0",sku:"",option1:u.value,option1_id:u.id,option2:c.value,option2_id:c.id,option1UniqueCode:u.uniqueCode})})}),this.product.variants=d}},showVariants(){return this.product.options.some(i=>i.values.length>0)},async updateProduct(){this.storing=!0,this.errors=[],console.log(this.product),await b.post(`/api/admin/product/update/${this.product.id}`,this.product,{headers:{"Content-Type":"multipart/form-data"}}).then(i=>{this.toast.success("Product created successfully",{timeout:2e3}),console.log(i),this.storing=!1,this.$router.push({name:"products"})}).catch(i=>{this.toast.error("Failed to create product",{timeout:2e3}),console.log(i),this.storing=!1}),this.isCreating=!1},async validateForm(){}},async mounted(){try{const i=await b.get("/api/admin/categories/id-name"),e=await b.get("/api/admin/brands/id-name"),s=await b.get(`/api/admin/product/${this.$route.params.id}`);this.categories=i.data.categories,this.brands=e.data.brands,this.product=s.data.product,this.product.price=this.product.variants[0].price.toString(),this.product.quantity=this.product.variants[0].inventory_quantity.toString();let r={};for(let t=0;t<this.product.options.length;t++)for(let n=0;n<this.product.options[t].values.length;n++){let d=this.product.options[t].values[n].id,u=Math.random().toString(36).substr(2,9);this.product.options[t].values[n].uniqueCode=u,r[d]=u}this.product.variants.forEach(t=>{t.inventory_quantity=t.inventory_quantity.toString(),r[t.option1_id]&&(t.option1UniqueCode=r[t.option1_id]),r[t.option2_id]&&(t.option2UniqueCode=r[t.option2_id])}),console.log(this.product)}catch{this.toast.error("Failed to load categories and brands")}}},L={class:""},J=o("div",{class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},[o("h5",{class:"h5"},"Update Product")],-1),G={class:"text-base text-slate-600 dark:text-slate-300 grid grid-cols-12 items-center gap-4"},H={class:"col-span-12 md:col-span-6"},W={class:"col-span-12 md:col-span-6"},X={class:"col-span-12 md:col-span-6"},Y={class:"col-span-12 sm:col-span-6"},Z={class:"col-span-12"},$={class:"col-span-12 md:col-span-6"},tt={class:"col-span-12 md:col-span-6"},et={class:"col-span-12 sm:col-span-6"},ot=o("div",{class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},[o("h5",{class:"h5"},"Product Variants")],-1),st={key:0,class:"text-base text-slate-600 dark:text-slate-300 items-center gap-4 rounded-lg"},it={class:""},nt={class:"flex justify-between py-2"},lt=o("label",{for:""}," Option Name ",-1),rt=["onClick"],ut=o("span",{class:"text-base"}," Delete option ",-1),dt=[ut],at={class:""},pt={class:"flex justify-between py-2"},ct=o("label",{for:""}," Option Values ",-1),mt=["onClick"],ht=o("i",{class:"bx bx-plus"},null,-1),ft={class:"text-base"},_t={key:0,class:"col-span-6"},gt=["onChange"],yt={key:0,class:"flex gap-3 py-2"},bt=["onClick"],vt=o("i",{class:"bx bx-trash"},null,-1),xt=[vt],Vt=["src"],Ct=["onClick"],qt=o("i",{class:"bx bx-trash"},null,-1),Ut=[qt],kt={key:1,class:"text-blue-600 pointer-events-auto"},St=o("i",{class:"bx bx-plus"},null,-1),wt={key:2,class:"mt-8"},Et={class:"table-auto w-full"},Ot=o("tr",null,[o("th",{class:"text-left h6 text-sm"},"Title"),o("th",{class:"text-left h6 text-sm"},"Price"),o("th",{class:"text-left h6 text-sm"},"Inventory Quantity")],-1),Ft={class:"col-span-12 py-3 flex justify-end space-x-3 border-t border-slate-100 dark:border-slate-700"},Tt={key:1,type:"button",class:"px-3 py-2 bg-blue-600 flex items-center gap-2 rounded"},Bt=o("div",{class:"flex flex-row space-x-4"},[o("div",{class:"w-4 h-4 rounded-full animate-spin border-2 border-dashed border-white border-t-transparent"})],-1);function Pt(i,e,s,r,t,n){const d=g("Textinput"),u=g("Select"),c=g("Textarea"),S=g("Switch"),C=g("Card"),w=g("Button");return a(),p("div",L,[o("form",{onSubmit:e[9]||(e[9]=P(l=>n.updateProduct(),["prevent"])),class:"flex flex-col gap-4 relative z-[100]"},[m(C,{noborder:""},{default:k(()=>[J,o("div",G,[o("div",H,[m(d,{type:"text",placeholder:"Name of the product",name:"name",modelValue:t.product.title,"onUpdate:modelValue":e[0]||(e[0]=l=>t.product.title=l),error:t.formErrors.title,classInput:"h-[48px]"},null,8,["modelValue","error"])]),o("div",W,[m(u,{modelValue:t.product.category_id,"onUpdate:modelValue":e[1]||(e[1]=l=>t.product.category_id=l),error:t.formErrors.category_id,options:t.categories,placeholder:"Select category",classInput:"h-[48px]"},null,8,["modelValue","error","options"])]),o("div",X,[m(u,{modelValue:t.product.brand_id,"onUpdate:modelValue":e[2]||(e[2]=l=>t.product.brand_id=l),error:t.formErrors.brand_id,options:t.brands,placeholder:"Select Brand",classInput:"h-[48px]"},null,8,["modelValue","error","options"])]),o("div",Y,[o("input",{type:"file",name:"file-input-medium",id:"file-input-medium",onChange:e[3]||(e[3]=(...l)=>n.handleFileUpload&&n.handleFileUpload(...l)),class:"block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4"},null,32)]),o("div",Z,[m(c,{placeholder:"Description of the product",modelValue:t.product.description,"onUpdate:modelValue":e[4]||(e[4]=l=>t.product.description=l),error:t.formErrors.description,hasicon:"",classInput:"min-h-[48px]"},null,8,["modelValue","error"])]),o("div",$,[m(d,{type:"text",placeholder:"Price",modelValue:t.product.price,"onUpdate:modelValue":e[5]||(e[5]=l=>t.product.price=l),error:t.formErrors.price,classInput:"h-[48px]"},null,8,["modelValue","error"])]),o("div",tt,[m(d,{type:"number",placeholder:"Quantity",modelValue:t.product.quantity,"onUpdate:modelValue":e[6]||(e[6]=l=>t.product.quantity=l),error:t.formErrors.quantity,classInput:"h-[48px]"},null,8,["modelValue","error"])]),o("div",et,[m(S,{label:"Is published",class:"",modelValue:t.product.status,"onUpdate:modelValue":e[7]||(e[7]=l=>t.product.status=l),activeClass:"bg-primary-500",active:!!t.product.status},null,8,["modelValue","active"])])])]),_:1}),m(C,{noborder:""},{default:k(()=>[ot,t.product.options.length>0?(a(),p("div",st,[(a(!0),p(v,null,x(t.product.options,(l,h)=>(a(),p("div",{class:"p-2 flex flex-col gap-2 relative border mb-2",key:h},[o("div",it,[o("div",nt,[lt,o("button",{onClick:f=>n.deleteOption(h),type:"button",class:"float-end text-xl text-danger-600 flex items-center"},dt,8,rt)]),m(u,{modelValue:l.name,"onUpdate:modelValue":f=>l.name=f,error:t.formErrors.options.name,options:[{label:"Color",value:"color"},{label:"Size",value:"size"}],placeholder:"Select option",classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])]),o("div",at,[o("div",pt,[ct,o("button",{onClick:f=>n.addValue(h),type:"button",class:"float-end text-xl text-blue-600 flex items-center"},[ht,V(),o("span",ft," Add another "+j(l.name?l.name:"Value"),1)],8,mt)]),(a(!0),p(v,null,x(l.values,(f,q)=>(a(),p("div",{class:"grid grid-cols-12 relative gap-2 pr-10 items-center justify-between mt-3",key:f.code},[o("div",{class:z(["relative h-fit",{"col-span-6":l.name=="color","col-span-12":l.name!="color"}])},[m(d,{type:"text",placeholder:"Value",modelValue:f.value,"onUpdate:modelValue":_=>f.value=_,onKeyup:_=>n.updateValue(f),error:t.formErrors.options.values,classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","onKeyup","error"]),l.name=="color"?(a(),p("div",{key:0,class:"w-4 h-4 rounded-full absolute top-3 right-3",style:I({backgroundColor:f.value})},null,4)):y("",!0)],2),l.name=="color"?(a(),p("div",_t,[o("input",{type:"file",multiple:"",name:"file-input-medium",id:"file-input-medium",onChange:_=>n.handleOptionFileSelected(_,h,q),class:"block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4"},null,40,gt),f.images_urls?(a(),p("div",yt,[(a(!0),p(v,null,x(JSON.parse(f.images_urls),(_,U)=>(a(),p("div",{class:"relative",key:U},[o("label",{for:"file-input-medium",onClick:jt=>i.deleOptionImage(i.optionValueId,U),class:"cursor-pointer text-danger-600 absolute right-0"},xt,8,bt),o("img",{class:"h-20 w-16",src:t.mediaUrl+_,alt:""},null,8,Vt)]))),128))])):y("",!0)])):y("",!0),o("button",{onClick:_=>n.deleteOptionValue(h,q),type:"button",class:"float-end text-xl absolute top-0 bottom-0 right-0"},Ut,8,Ct)]))),128))])]))),128))])):y("",!0),t.product.options.length<2?(a(),p("div",kt,[o("button",{onClick:e[8]||(e[8]=l=>n.addOption()),type:"button",class:""},[St,V(" Add options like color or size")])])):y("",!0),n.showVariants()?(a(),p("div",wt,[o("table",Et,[Ot,(a(!0),p(v,null,x(t.product.variants,l=>(a(),p("tr",{key:l.id},[o("td",null,[m(d,{type:"text",placeholder:"Title",name:"title",modelValue:l.title,"onUpdate:modelValue":h=>l.title=h,error:t.formErrors.variants.title,classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])]),o("td",null,[m(d,{type:"text",placeholder:"Price",name:"price",modelValue:l.price,"onUpdate:modelValue":h=>l.price=h,error:t.formErrors.variants.price,classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])]),o("td",null,[m(d,{type:"number",placeholder:"Inventory Quantity",name:"inventory_quantity",modelValue:l.inventory_quantity,"onUpdate:modelValue":h=>l.inventory_quantity=h,error:t.formErrors.variants.inventory_quantity,classInput:"h-[35px]"},null,8,["modelValue","onUpdate:modelValue","error"])])]))),128))])])):y("",!0)]),_:1}),o("div",Ft,[t.storing?(a(),p("button",Tt,[Bt,V(" Saving ")])):(a(),B(w,{key:0,type:"submit",text:"Save",btnClass:"btn-primary h-10 flex items-center"}))])],32)])}const Ht=F(K,[["render",Pt]]);export{Ht as default};
